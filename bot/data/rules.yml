version: "3.1"

rules:
  # ========================================
  # BÚSQUEDAS
  # ========================================
  
  - rule: Cualquier intent de búsqueda
    steps:
    - or:
      - intent: buscar_producto
      - intent: buscar_oferta
      - intent: modificar_busqueda
      - intent: consultar_novedades_producto
      - intent: consultar_novedades_oferta
    - action: action_busqueda_situacion

  # ========================================
  # CON SUGERENCIA PENDIENTE
  # ========================================
  
  - rule: Afirmación con sugerencia activa
    condition:
    - slot_was_set:
      - pending_suggestion:
          is_not: null
    steps:
    - intent: afirmar
    - action: action_conf_neg_agradecer

  - rule: Negación con sugerencia activa
    condition:
    - slot_was_set:
      - pending_suggestion:
          is_not: null
    steps:
    - intent: denegar
    - action: action_conf_neg_agradecer

  - rule: Agradecimiento con sugerencia activa
    condition:
    - slot_was_set:
      - pending_suggestion:
          is_not: null
    steps:
    - intent: agradecer  # ⚠️ CAMBIÓ: era "agradecimiento"
    - action: action_conf_neg_agradecer

  # ========================================
  # SIN SUGERENCIA PENDIENTE
  # ========================================
  
  - rule: Afirmación sin contexto especial
    condition:
    - slot_was_set:
      - pending_suggestion: null
    steps:
    - intent: afirmar
    - action: action_conf_neg_agradecer

  - rule: Negación sin contexto especial
    condition:
    - slot_was_set:
      - pending_suggestion: null
    steps:
    - intent: denegar
    - action: action_conf_neg_agradecer

  - rule: Agradecimiento sin contexto especial
    condition:
    - slot_was_set:
      - pending_suggestion: null
    steps:
    - intent: agradecer  # ⚠️ CAMBIÓ
    - action: action_conf_neg_agradecer

  - rule: Saludo
    steps:
    - intent: saludar
    - action: action_conf_neg_agradecer
  
  - rule: Despedida
    steps:
    - intent: despedida
    - action: action_conf_neg_agradecer