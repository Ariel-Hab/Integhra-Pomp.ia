version: "3.1"

rules:
  # ========================================
  # BÚSQUEDAS (COMPLEJO - Sin cambios)
  # ========================================
  
  - rule: Cualquier intent de búsqueda
    steps:
    - or:
      - intent: buscar_producto
      - intent: buscar_oferta
      - intent: modificar_busqueda
      # - intent: consultar_novedades_producto # (Estaban comentados en tu domain, pero los dejo)
      # - intent: consultar_novedades_oferta
    - action: action_busqueda_situacion

  # ========================================
  # CON SUGERENCIA PENDIENTE (COMPLEJO - Sin cambios)
  # ========================================
  
  - rule: Afirmación con sugerencia activa
    condition:
    - slot_was_set:
      - pending_suggestion:
          is_not: null
    steps:
    - intent: afirmar
    - action: action_conf_neg_agradecer

  - rule: Negación con sugerencia activa
    condition:
    - slot_was_set:
      - pending_suggestion:
          is_not: null
    steps:
    - intent: denegar
    - action: action_conf_neg_agradecer

  - rule: Agradecimiento con sugerencia activa
    condition:
    - slot_was_set:
      - pending_suggestion:
          is_not: null
    steps:
    - intent: agradecer
    - action: action_conf_neg_agradecer

  # ========================================
  # SIN SUGERENCIA PENDIENTE (COMPLEJO - Sin cambios)
  # (Esta action decide si el 'afirmar' es trivial o no)
  # ========================================
  
  - rule: Afirmación sin contexto especial
    condition:
    - slot_was_set:
      - pending_suggestion: null
    steps:
    - intent: afirmar
    - action: action_conf_neg_agradecer

  - rule: Negación sin contexto especial
    condition:
    - slot_was_set:
      - pending_suggestion: null
    steps:
    - intent: denegar
    - action: action_conf_neg_agradecer

  - rule: Agradecimiento sin contexto especial
    condition:
    - slot_was_set:
      - pending_suggestion: null
    steps:
    - intent: agradecer
    - action: action_conf_neg_agradecer

  # ========================================
  # MODIFICACIONES DE BÚSQUEDA (COMPLEJO - Sin cambios)
  # ========================================
  
  - rule: Modificar búsqueda múltiple
    steps:
    - intent: modificar_busqueda:multiple
    - action: action_busqueda_situacion
    
  - rule: Modificar búsqueda - Remover filtro
    steps:
    - intent: modificar_busqueda:remover
    - action: action_busqueda_situacion

  - rule: Modificar búsqueda - Agregar filtro
    steps:
    - intent: modificar_busqueda:agregar
    - action: action_busqueda_situacion

  - rule: Modificar búsqueda - Reemplazar filtro
    steps:
    - intent: modificar_busqueda:reemplazar
    - action: action_busqueda_situacion

  - rule: Modificar búsqueda genérica
    steps:
    - intent: modificar_busqueda
    - action: action_busqueda_situacion

  # ========================================
  # SMALL TALK (TRIVIAL - ¡MODIFICADO!)
  # ========================================
  
  - rule: Saludo
    steps:
    - intent: saludo
    - action: utter_saludo # <-- CAMBIADO

  - rule: Despedida
    steps:
    - intent: despedida
    - action: utter_despedida # <-- CAMBIADO
  
  - rule: Responder a preguntar_como_estas
    steps:
    - intent: preguntar_como_estas
    - action: utter_preguntar_como_estas # <-- CAMBIADO

  - rule: Responder a responder_como_estoy
    steps:
    - intent: responder_como_estoy
    - action: utter_responder_como_estoy # <-- CAMBIADO

  - rule: Pedir chiste
    steps:
    - intent: pedir_chiste
    - action: utter_pedir_chiste # <-- CAMBIADO

  - rule: Usuario se ríe
    steps:
    - intent: reirse
    - action: utter_reirse_chiste # <-- CAMBIADO

  - rule: Responder a responder_estoy_bien
    steps:
    - intent: responder_estoy_bien
    - action: utter_responder_estoy_bien # <-- CAMBIADO

  # ========================================
  # AYUDA Y FUERA DE CONTEXTO (COMPLEJO - Sin cambios)
  # ========================================
  
  - rule: Pedir ayuda
    steps:
    - intent: pedir_ayuda
    - action: action_explicar_ayuda # <-- (Se mantiene, es complejo)

  - rule: Manejar conversación casual (off-topic)
    steps:
    - intent: off_topic
    - action: action_handle_out_of_context # <-- (Se mantiene, es complejo)

  - rule: Manejar consultas fuera de dominio
    steps:
    - intent: out_of_scope
    - action: action_handle_out_of_context # <-- (Se mantiene, es complejo)

  - rule: Manejar consultas veterinarias profesionales
    steps:
    - intent: consulta_veterinaria_profesional
    - action: action_handle_out_of_context # <-- (Se mantiene, es complejo)
    
  - rule: Activar fallback
    steps:
      - intent: nlu_fallback
      - action: action_fallback # <-- (Se mantiene, es complejo)