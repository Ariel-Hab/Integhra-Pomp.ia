version: "3.1"

rules:
  # ========================================
  # BÚSQUEDAS
  # ========================================
  
  - rule: Cualquier intent de búsqueda
    steps:
    - or:
      - intent: buscar_producto
      - intent: buscar_oferta
      - intent: modificar_busqueda
      - intent: consultar_novedades_producto
      - intent: consultar_novedades_oferta
    - action: action_busqueda_situacion

  # ========================================
  # CON SUGERENCIA PENDIENTE
  # ========================================
  
  - rule: Afirmación con sugerencia activa
    condition:
    - slot_was_set:
      - pending_suggestion:
          is_not: null
    steps:
    - intent: afirmar
    - action: action_conf_neg_agradecer

  - rule: Negación con sugerencia activa
    condition:
    - slot_was_set:
      - pending_suggestion:
          is_not: null
    steps:
    - intent: denegar
    - action: action_conf_neg_agradecer

  - rule: Agradecimiento con sugerencia activa
    condition:
    - slot_was_set:
      - pending_suggestion:
          is_not: null
    steps:
    - intent: agradecer
    - action: action_conf_neg_agradecer

  # ========================================
  # SIN SUGERENCIA PENDIENTE
  # ========================================
  
  - rule: Afirmación sin contexto especial
    condition:
    - slot_was_set:
      - pending_suggestion: null
    steps:
    - intent: afirmar
    - action: action_conf_neg_agradecer

  - rule: Negación sin contexto especial
    condition:
    - slot_was_set:
      - pending_suggestion: null
    steps:
    - intent: denegar
    - action: action_conf_neg_agradecer

  - rule: Agradecimiento sin contexto especial
    condition:
    - slot_was_set:
      - pending_suggestion: null
    steps:
    - intent: agradecer
    - action: action_conf_neg_agradecer

  # ========================================
  # MODIFICACIONES DE BÚSQUEDA
  # ========================================
  
  - rule: Modificar búsqueda múltiple
    steps:
    - intent: modificar_busqueda:multiple
    - action: action_busqueda_situacion
    
  - rule: Modificar búsqueda - Remover filtro
    steps:
    - intent: modificar_busqueda:remover
    - action: action_busqueda_situacion

  - rule: Modificar búsqueda - Agregar filtro
    steps:
    - intent: modificar_busqueda:agregar
    - action: action_busqueda_situacion

  - rule: Modificar búsqueda - Reemplazar filtro
    steps:
    - intent: modificar_busqueda:reemplazar
    - action: action_busqueda_situacion

  - rule: Modificar búsqueda genérica
    steps:
    - intent: modificar_busqueda
    - action: action_busqueda_situacion

  # ========================================
  # SMALL TALK
  # ========================================
  
  - rule: Saludo
    steps:
    - intent: saludo
    - action: action_smalltalk_situacion
  
  - rule: Despedida
    steps:
    - intent: despedida
    - action: action_smalltalk_situacion

  - rule: Responder a preguntar_como_estas
    steps:
    - intent: preguntar_como_estas
    - action: action_smalltalk_situacion

  - rule: Responder a responder_como_estoy
    steps:
    - intent: responder_como_estoy
    - action: action_smalltalk_situacion

  - rule: Pedir chiste
    steps:
    - intent: pedir_chiste
    - action: action_smalltalk_situacion

  - rule: Usuario se ríe
    steps:
    - intent: reirse
    - action: action_smalltalk_situacion
  - rule: Responder a responder_estoy_bien
    steps:
    - intent: responder_estoy_bien
    - action: action_smalltalk_situacion

  - rule: Pedir ayuda
    steps:
    - intent: pedir_ayuda
    - action: action_explicar_ayuda

  # ========================================
  # MENSAJES FUERA DE CONTEXTO
  # ========================================
  
  - rule: Manejar conversación casual (off-topic)
    steps:
    - intent: off_topic
    - action: action_handle_out_of_context

  - rule: Manejar consultas fuera de dominio
    steps:
    - intent: out_of_scope
    - action: action_handle_out_of_context

  - rule: Manejar consultas veterinarias profesionales
    steps:
    - intent: consulta_veterinaria_profesional
    - action: action_handle_out_of_context
    
  - rule: Activar fallback
    steps:
      - intent: nlu_fallback
      - action: action_fallback